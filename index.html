<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>ElementHTML â€¢ TodoMVC</title>
    <link rel="stylesheet" href="css/base.css">
    <link rel="stylesheet" href="css/index.css">
    <link rel="stylesheet" href="css/app.css">
    <script type="importmap">
        {
            "imports": {
                "main": "./packages/main.js"
            }
        }
    </script>
    <script type="module" src='../element/element.js?load&expose'></script>
    <!-- <script type="module"
    src='https://cdn.jsdelivr.net/gh/elementhtml/element@f4fe89d10258adc15f6a46ec6adb88f44f2f0a9c/element.js?load&expose&packages=main'></script> -->
    <link rel="stylesheet" href="theme/dark.css">
    <meta is="e-router" id="router">

    <meta is="e-pipe" :="`localStorage.setItem(todos-elementhtml) -> getItem(todos-elementhtml)`" sync="todos"
        content-type="json">

    <meta is="e-cmap"
        :=':|.new-todo >> ($trim($.value) ? [$append($cell, {"id": $uuid(), "title": $.value, "completed": false})] : $cell) >> todos'>
    <meta is="e-cmap"
        :=':|#toggle-all >> [$map($cell, function($t){ $merge([$t, {"completed": $.checked }]) })] >> todos'>
    <meta is="e-cmap" :=':|.clear-completed >> [$filter($cell, function($t){ $not($t.completed) })] >> todos'>

    <meta is="e-cmap" :='todos >> ( $numCompleted := $count([$filter($, function($t){ $t.completed })]); $numActive := $count($) - $numCompleted ; {
        "`:|.new-todo`": {"value": "", "focus()": true}, 
        "`:|#toggle-all`": {"checked": $numCompleted = $count($) },
        "`:|footer`": {
            "`.todo-count`": {"<>": $numActive = 1 ? "<strong>1</strong> item left" : ("<strong>" & $numActive & "</strong> items left")  }, 
            "`.clear-completed`": {"^display": $numCompleted ? "block" : "none"} 
        },
        "<%:|template%>": [$map($, function($t){ { "#": $t.id, "&completed": $t.completed, "&editing": $boolean($t.editing), 
            "`.edit`": {"value": $t.title, "focus()": true }, "`label`": $t.title, "`.toggle`": {"checked": $t.completed } } })]
    }) >> :|.todo-list'>

    <template>
        <li>
            <div class="view">
                <meta is="e-cmap"
                    :='|.toggle >> [$map($cell, function($t){ ($t.id = $find("li|").id) ? $merge([$t, {"completed": $not($t.completed) }]) : $t })] >> todos'>
                <meta is="e-cmap" :='|.destroy >> [$filter($cell, function($t){ $t.id != $find("li|").id })] >> todos'>
                <meta is="e-cmap"
                    :='!dblclick|label >> [$map($cell, function($t){ ($t.id = $find("li|").id) ? $merge([$t, {"editing": $t.title }]) : $t })] >> todos'>
                <input class="toggle" type="checkbox">
                <label></label>
                <button class="destroy"></button>
            </div>
            <meta is="e-cmap" :='!change,focusout|.edit >> ($val := $trim($.value) ; $val  
                    ? [$map($cell, function($t){ ($t.id = $find("li|").id) ? $sift($merge([$t, {"title": $t.esc ? $t.esc : $val, "editing": null, "esc": null}]), function($v) { $v != null }) : $t })] 
                    : [$filter($cell, function($t){ $t.id != $find("li|").id })] ) >> todos'>
            <meta is="e-cmap" :='!keydown|.edit >> ( $event.key = "Escape" 
                ? [$map($cell, function($t){ ($t.id = $find("li|").id) ? $merge([$t, {"esc": $t.editing, "editing": null}]) : $t })]
                : $stop() ) >> todos'>
            <input class="edit">
        </li>
    </template>

</head>

<body>
    <section class="todoapp">
        <header class="header">
            <h1>todos</h1>
            <input class="new-todo" placeholder="What needs to be done?" autofocus>
        </header>
        <main>
            <input id="toggle-all" class="toggle-all" type="checkbox">
            <label for="toggle-all">Mark all as complete</label>
            <ul class="todo-list"></ul>
        </main>
        <footer>
            <span class="todo-count"><strong>0</strong> items left</span>
            <ul class="filters">
                <li>
                    <a href="#/">All</a>
                </li>
                <li>
                    <a href="#/active">Active</a>
                </li>
                <li>
                    <a href="#/completed">Completed</a>
                </li>
            </ul>
            <button class="clear-completed">Clear completed</button>
        </footer>
    </section>
    <footer class="info">
        <p>Double-click to edit a todo</p>
        <p>
            Created by <a href="http://drpitman.name">David Pitman</a> using <a
                href="http://elementhtml.dev">Element</a>
        </p>
        <p>Part of <a href="http://todomvc.com">TodoMVC</a></p>
    </footer>
</body>

</html>